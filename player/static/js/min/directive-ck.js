playerApp.directive("musicMode",["$timeout","$document",function(e,t){return{restrict:"AE",replace:!0,scope:{player:"=",audio:"="},templateUrl:"tpls/mode.html",link:function(a,i,o){var r="list";a.addActive=function(e){i.children("li").removeClass("active"),i.children("li").eq(e).addClass("active")},a.addActive(0),a.listPlay=function(){r="list",console.log("list"),a.addActive(0)},a.randomPlay=function(){console.log("random"),r="random",a.addActive(1)},a.repeatPlay=function(){r="repeat",console.log("repeat"),a.addActive(2)},a.audio.addEventListener("ended",function(){if("list"==r)a.player.active==a.player.musicLen-1?a.player.active=0:a.player.active+=1;else if("random"==r){var e=parseInt(a.player.musicLen*Math.random());console.log("randomPlay"+e),e==a.player.active&&(e+=1),a.player.active=e}else console.log("repeat");a.$apply(a.player.controllPlay(a.player.active))});var n;a.volShow=!1,a.showVol=function(){a.volShow=!0,clearTimeout(n)},a.hideVol=function(){n=e(function(){a.volShow=!1},300)},a.volStyle="height: 64px",a.audio.volume=.8,a.adjustVolume=function(e){var i=window.event||e,o=t[0].querySelector(".play-vol").getBoundingClientRect().bottom-i.clientY;a.audio.volume=(o/75).toFixed(2),a.volStyle="height:"+o+"px"},a.muted=!0,a.audioMuted=function(){0==a.audio.muted?(a.audio.muted=!0,a.muted=!1):(a.audio.muted=!1,a.muted=!0)}}}}]),playerApp.directive("progressBar",["$document","$interval","$rootScope",function(e,t,a){return{restrict:"AE",replace:!0,scope:{player:"=",audio:"="},templateUrl:"tpls/progress.html",link:function(i,o,r,n){console.log(a),i.surplusBar=function(){if(!isNaN(i.audio.duration)){var e=i.audio.duration-i.audio.currentTime,t=parseInt(e/60),a=parseInt(e%60);10>a&&(a="0"+a),i.playTime="-"+t+":"+a;var o=i.audio.currentTime/i.audio.duration*1e3;i.surplusWidth="width:"+parseInt(o)+"px"}},i.bufferBar=function(){bufferTimer=t(function(){var e=i.audio.buffered.length;if(e>0&&void 0!=i.audio.buffered){var t=i.audio.buffered.end(e-1)/i.audio.duration*1e3;i.bufferWidth="width:"+parseInt(t)+"px",Math.abs(i.audio.duration-i.audio.buffered.end(e-1))<1&&(i.bufferWidth="width: 1000px",clearInterval(bufferTimer))}},1e3)},i.adjustPorgress=function(t){var a=window.event||t,o=a.clientX-e[0].querySelector(".progress-bar").getBoundingClientRect().left;i.audio.currentTime=parseInt(o/1e3*i.audio.duration),i.audio.removeEventListener("canplay",i.bufferBar)},i.audio.addEventListener("timeupdate",function(){i.$apply(i.surplusBar())}),i.audio.addEventListener("canplay",function(){i.$apply(i.bufferBar())})}}}]);